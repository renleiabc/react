(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{13:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABzUlEQVRYR+2XQU7CUBCGZ4otKw3uTLQENtquxBPIDcQTqDfQE4gnUG6AJxBPIJ5AdkU3GoqJO4Gd7wljWorQvrapQh8xsds2M9/88978U4QlP7jk/PD3AaytlTIqeOMoSSM6NLufzZ+oOrcCVl6rIsD5OCn1sgNeLPaglxRifgBdbSLi/jQhnRkdfiUNoK2rLUDc/U5IcGvYrCIF4GlTLY0y+DCbjIjuTZuXpQBYulpHxKOlAIRV7x5DGQo85yD3saY50hcEqUdUM7r8NNUWWMLJn6ZDGh7u2MNGKgBO5WxVvSTE46gExFjRfIOXXwE4U01RlJk7PQ6jDVjNGS5tXWsAwkFccASoxr2fxJp84xtE0dKOh0uc9EkrhsAZ8QP4xurMbAO4MDusuhCAwKCSDkBeMeEtkKBA8JbIVyBwS3wAj3qmQphxvd03Xhd2BqhvdHhuNrZfAXe5UO5SAwhxSrkAIO4KUgGUIe1tv/JWZAs8k3lPpwVi/508wkrWzmuUBgARXZs2FzxEJsCJafN6sDhpANkBWw/blkWA4JLpbDneHEjihqGmFLOohgCEWa7nhhtQANXdAwXLjnZD6hPjpagdYe7/gsQ2HPHhP8AXr5kcMA++kXUAAAAASUVORK5CYII="},19:function(e,t,a){e.exports=a(38)},25:function(e,t,a){},29:function(e,t,a){},31:function(e,t,a){},33:function(e,t,a){},35:function(e,t,a){},38:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(18),s=a.n(o),c=(a(25),a(3)),l=a(4),i=a(6),u=a(5),h=a(7),m=a(40),d=a(42),p=a(43),f=a(2),v=a(39),b=function(e){function t(){return Object(c.a)(this,t),Object(i.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.username,a=e.onLogout,n=e.location;return r.a.createElement("div",{className:"header"},r.a.createElement("div",{className:"nav"},r.a.createElement("span",{className:"left-link"},r.a.createElement(v.a,{to:"/"},"\u9996\u9875")),t&&t.length>0?r.a.createElement("span",{className:"user"},"\u5f53\u524d\u7528\u6237\uff1a",t,"\xa0",r.a.createElement("input",{type:"button",onClick:a,value:"\u6ce8\u9500"})):r.a.createElement("span",{className:"right-link"},r.a.createElement(v.a,{to:{pathname:"/login",state:{from:n}}},"\u767b\u5f55"))))}}]),t}(n.Component),g=a(16),C=function(e){function t(e){var a;Object(c.a)(this,t);var n=(a=Object(i.a)(this,Object(u.a)(t).call(this,e))).props.post;return a.state={title:n&&n.title||"",content:n&&n.content||""},a.handleCancelClick=a.handleCancelClick.bind(Object(f.a)(Object(f.a)(a))),a.handleSaveClick=a.handleSaveClick.bind(Object(f.a)(Object(f.a)(a))),a.handleChange=a.handleChange.bind(Object(f.a)(Object(f.a)(a))),a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"handleChange",value:function(e){var t=e.target.name;"title"===t?this.setState({title:e.target.value}):"content"===t?this.setState({content:e.target.value}):console.log("do nothing")}},{key:"handleSaveClick",value:function(){var e={title:this.state.title,content:this.state.content};this.props.onSave(e)}},{key:"handleCancelClick",value:function(){this.props.onCancel()}},{key:"render",value:function(){return r.a.createElement("div",{className:"postEditor"},r.a.createElement("input",{type:"text",name:"title",value:this.state.title,onChange:this.handleChange}),r.a.createElement("textarea",{name:"content",placeholder:"\u5185\u5bb9",value:this.state.contnet,onChange:this.handleChange}),r.a.createElement("button",{onClick:this.handleCancelClick},"\u53d6\u6d88"),r.a.createElement("button",{onClick:this.handleSaveClick,className:"editor-save"},"\u4fdd\u5b58"))}}]),t}(n.Component);function E(e){var t=new Date(e),a=t.getFullYear(),n=t.getMonth()+1+"";n=1===n.length?"0"+n:n;var r=t.getDate()+"";r=1===r.length?"0"+r:r;var o=t.getHours()+"";o=1===o.length?"0"+o:o;var s=t.getMinutes()+"";return s=1===s.length?"0"+s:s,"".concat(a,"-").concat(n,"-").concat(r," ").concat(o,":").concat(s)}a(29);var O=a(13),j=a.n(O);var k=function(e){console.log(e);var t=e.post,a=e.editable,n=e.onEditClick;return r.a.createElement("div",{className:"postView"},r.a.createElement("div",null,r.a.createElement("h2",null,t.title),r.a.createElement("div",{className:"mark"},r.a.createElement("span",{className:"author"},t.author.username),r.a.createElement("span",null,"\xb7"),r.a.createElement("span",null,E(t.updatedAt)),a?r.a.createElement("span",null,"\xb7",r.a.createElement("button",{onClick:n},"\u7f16\u8f91")):null),r.a.createElement("div",{className:"content"},t.content)),r.a.createElement("div",{className:"vote"},r.a.createElement("span",null,r.a.createElement("img",{alt:"vote",src:j.a})),r.a.createElement("span",null,t.vote)))},A=(a(31),function(e){function t(){return Object(c.a)(this,t),Object(i.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.comments;return console.log(e),r.a.createElement("ul",{className:"commentsView"},e.map(function(e){return console.log(e.author),r.a.createElement("li",{key:e.id},r.a.createElement("div",null,e.content),r.a.createElement("div",{className:"sub"},e.author?r.a.createElement("span",null,e.author.username):r.a.createElement("span",null,"\u533f\u540d"),r.a.createElement("span",null,"\u2022"),r.a.createElement("span",null,E(e.updatedAt))))}))}}]),t}(n.Component)),S=(a(33),function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(i.a)(this,Object(u.a)(t).call(this,e))).state={value:""},a.handleChange=a.handleChange.bind(Object(f.a)(Object(f.a)(a))),a.handleClick=a.handleClick.bind(Object(f.a)(Object(f.a)(a))),a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"handleChange",value:function(e){this.setState({value:e.target.value})}},{key:"handleClick",value:function(e){this.state.value.length>0?(this.props.onSubmit(this.state.value),this.setState({value:""})):alert("\u8bc4\u8bba\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a\uff01 ")}},{key:"render",value:function(){var e=this.props,t=e.comments,a=e.editable;return r.a.createElement("div",{className:"commentList"},r.a.createElement("div",{className:"title"},r.a.createElement("div",{className:"comments"},"\u8bc4\u8bba"),a?r.a.createElement("div",{className:"editor"},r.a.createElement("textarea",{placeholder:"\u8bf4\u8bf4\u4f60\u7684\u770b\u6cd5",value:this.state.value,onChange:this.handleChange}),r.a.createElement("button",{onClick:this.handleClick},"\u63d0\u4ea4")):null,r.a.createElement(A,{comments:t})))}}]),t}(n.Component));var y=Date.now(),w=function(e){function t(e,t){return e<<t|e>>>32-t}function a(e){var t,a="";for(t=7;t>=0;t--)a+=(e>>>4*t&15).toString(16);return a}var n,r,o,s,c,l,i,u,h,m=new Array(80),d=1732584193,p=4023233417,f=2562383102,v=271733878,b=3285377520,g=(e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",a=0;a<e.length;a++){var n=e.charCodeAt(a);n<128?t+=String.fromCharCode(n):n>127&&n<2048?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t}(e)).length,C=new Array;for(r=0;r<g-3;r+=4)o=e.charCodeAt(r)<<24|e.charCodeAt(r+1)<<16|e.charCodeAt(r+2)<<8|e.charCodeAt(r+3),C.push(o);switch(g%4){case 0:r=2147483648;break;case 1:r=e.charCodeAt(g-1)<<24|8388608;break;case 2:r=e.charCodeAt(g-2)<<24|e.charCodeAt(g-1)<<16|32768;break;case 3:r=e.charCodeAt(g-3)<<24|e.charCodeAt(g-2)<<16|e.charCodeAt(g-1)<<8|128}for(C.push(r);C.length%16!=14;)C.push(0);for(C.push(g>>>29),C.push(g<<3&4294967295),n=0;n<C.length;n+=16){for(r=0;r<16;r++)m[r]=C[n+r];for(r=16;r<=79;r++)m[r]=t(m[r-3]^m[r-8]^m[r-14]^m[r-16],1);for(s=d,c=p,l=f,i=v,u=b,r=0;r<=19;r++)h=t(s,5)+(c&l|~c&i)+u+m[r]+1518500249&4294967295,u=i,i=l,l=t(c,30),c=s,s=h;for(r=20;r<=39;r++)h=t(s,5)+(c^l^i)+u+m[r]+1859775393&4294967295,u=i,i=l,l=t(c,30),c=s,s=h;for(r=40;r<=59;r++)h=t(s,5)+(c&l|c&i|l&i)+u+m[r]+2400959708&4294967295,u=i,i=l,l=t(c,30),c=s,s=h;for(r=60;r<=79;r++)h=t(s,5)+(c^l^i)+u+m[r]+3395469782&4294967295,u=i,i=l,l=t(c,30),c=s,s=h;d=d+s&4294967295,p=p+c&4294967295,f=f+l&4294967295,v=v+i&4294967295,b=b+u&4294967295}return(h=a(d)+a(p)+a(f)+a(v)+a(b)).toLowerCase()}("A6053788184630UZ8B3F5860-2646-2C47-DC50-39106919B260UZ"+y)+"."+y,N=new Headers({"X-APICloud-AppId":"A6053788184630","X-APICloud-AppKey":w,Accept:"application/json","Content-Type":"application/json"});function P(e){return fetch(e,{method:"GET",headers:N}).then(function(t){return U(e,t)}).catch(function(t){return console.error("Request failed. Url = ".concat(e," . Message = ").concat(t)),{error:{message:"Request failed."}}})}function I(e,t){return fetch(e,{method:"POST",headers:N,body:JSON.stringify(t)}).then(function(t){return U(e,t)}).catch(function(t){return console.error("Request failed. Url = ".concat(e," . Message = ").concat(t)),{error:{message:"Request failed."}}})}function U(e,t){return t.status<500?t.json():(console.error("Request failed. Url = ".concat(e," . Message = ").concat(t.statusText)),{error:{message:"Request failed due to server error "}})}var x={fields:["id","title","author","vote","updatedAt"],limit:10,order:"updatedAt DESC",include:"authorPointer",includefilter:{user:{fields:["id","username"]}}};function D(e){return encodeURIComponent(JSON.stringify(e))}var L=function(){return"/user/login"},R=function(){return"/post?filter=".concat(D(x))},B=function(e){return"/post?filter=".concat(D(function(e){return{fields:["id","title","author","vote","updatedAt","content"],where:{id:e},include:"authorPointer",includefilter:{user:{fields:["id","username"]}}}}(e)))},M=function(){return"/post"},q=function(e){return"/post/".concat(e)},J=function(e){return"/comment?filter=".concat(D(function(e){return{fields:["id","author","updatedAt","content"],where:{post:e},limit:20,order:"updatedAt DESC",include:"authorPointer",includefilter:{user:{fields:["id","username"]}}}}(e)))},Q=function(){return"/comment"},T=(a(35),function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(i.a)(this,Object(u.a)(t).call(this,e))).state={post:null,comments:[],editing:!1},a.handleEditClick=a.handleEditClick.bind(Object(f.a)(Object(f.a)(a))),a.handleCommentSubmit=a.handleCommentSubmit.bind(Object(f.a)(Object(f.a)(a))),a.handlePostSave=a.handlePostSave.bind(Object(f.a)(Object(f.a)(a))),a.handlePostCnacel=a.handlePostCnacel.bind(Object(f.a)(Object(f.a)(a))),a.refreshCommments=a.refreshCommments.bind(Object(f.a)(Object(f.a)(a))),a.refreshPost=a.refreshPost.bind(Object(f.a)(Object(f.a)(a))),a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.refreshCommments(),this.refreshPost()}},{key:"refreshPost",value:function(){var e=this,t=this.props.match.params.id;P(B(t)).then(function(t){t.error||1!==t.length||e.setState({post:t[0]})})}},{key:"refreshCommments",value:function(){var e=this,t=this.props.match.params.id;P(J(t)).then(function(t){t.error||e.setState({comments:t})})}},{key:"handleEditClick",value:function(){this.setState({editing:!0})}},{key:"handlePostSave",value:function(e){var t=this.props.match.params.id;this.savePost(t,e)}},{key:"handlePostCnacel",value:function(){this.setState({editing:!1})}},{key:"handleCommentSubmit",value:function(e){var t=this.props.match.params.id,a={author:this.props.userId,post:t,content:e};this.saveComment(a)}},{key:"saveComment",value:function(e){var t=this;I(Q(),e).then(function(e){e.error||t.refreshCommments()})}},{key:"savePost",value:function(e,t){var a=this;(function(e,t){return fetch(e,{method:"PUT",headers:N,body:JSON.stringify(t)}).then(function(t){return U(e,t)}).catch(function(t){return console.error("Request failed. Url = ".concat(e," . Message = ").concat(t)),{error:{message:"Request failed."}}})})(q(e),t).then(function(e){if(!e.error){var t=Object(g.a)({},e,{author:a.state.post.author});a.setState({post:t,editing:!1})}})}},{key:"render",value:function(){var e=this.state,t=e.post,a=e.comments,n=e.editing;console.log(t);var o=this.props.userId;if(!t)return null;var s=o===t.author.id;return r.a.createElement("div",{className:"post"},n?r.a.createElement(C,{post:t,onSave:this.handlePostSave,onCancel:this.handlePostCnacel}):r.a.createElement(k,{post:t,editable:s,onEditClick:this.handleEditClick}),r.a.createElement(S,{comments:a,editable:Boolean(o),onSubmit:this.handleCommentSubmit}))}}]),t}(n.Component));var G=function(e){var t=e.post;return r.a.createElement("li",{className:"postItem"},r.a.createElement("div",{className:"title"},t.title),r.a.createElement("div",null,"\u521b\u5efa\u4eba\uff1a",r.a.createElement("span",null,t.author.username)),r.a.createElement("div",null,"\u66f4\u65b0\u65f6\u95f4\uff1a",r.a.createElement("span",null,E(t.updatedAt))),r.a.createElement("div",{className:"like"},r.a.createElement("span",null,r.a.createElement("img",{alt:"vote",src:j.a})),r.a.createElement("span",null,t.vote)))},X=function(e){function t(){return Object(c.a)(this,t),Object(i.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.posts;return r.a.createElement("ul",null,e.map(function(e){return r.a.createElement(v.a,{key:e.id,to:"/posts/".concat(e.id)},r.a.createElement(G,{post:e}))}))}}]),t}(n.Component),W=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(i.a)(this,Object(u.a)(t).call(this,e))).state={posts:[],newPost:!1},a.handleCancel=a.handleCancel.bind(Object(f.a)(Object(f.a)(a))),a.handleSave=a.handleSave.bind(Object(f.a)(Object(f.a)(a))),a.handleNewPost=a.handleNewPost.bind(Object(f.a)(Object(f.a)(a))),a.refreshPostList=a.refreshPostList.bind(Object(f.a)(Object(f.a)(a))),a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.refreshPostList()}},{key:"refreshPostList",value:function(){var e=this;P(R()).then(function(t){t.error||e.setState({posts:t,newPost:!1})})}},{key:"handleSave",value:function(e){var t=this,a=Object(g.a)({},e,{author:this.props.userId,vote:0});I(M(),a).then(function(e){e.error||t.refreshPostList()})}},{key:"handleCancel",value:function(){this.setState({newPost:!1})}},{key:"handleNewPost",value:function(){this.setState({newPost:!0})}},{key:"render",value:function(){var e=this.props.userId;return r.a.createElement("div",{className:"postList"},r.a.createElement("div",null,r.a.createElement("h2",null,"\u5e16\u5b50\u5217\u8868"),e?r.a.createElement("button",{onClick:this.handleNewPost},"\u53d1\u5e16"):null),this.state.newPost?r.a.createElement(C,{onSave:this.handleSave,onCancel:this.handleCancel}):null,r.a.createElement(X,{posts:this.state.posts}))}}]),t}(n.Component),K=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(i.a)(this,Object(u.a)(t).call(this,e))).state={userId:sessionStorage.getItem("userId"),username:sessionStorage.getItem("username")},a.handleLogout=a.handleLogout.bind(Object(f.a)(Object(f.a)(a))),a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"handleLogout",value:function(){sessionStorage.removeItem("userId"),sessionStorage.removeItem("username"),this.setState({userId:null,username:null,redirectToReferrer:!1})}},{key:"render",value:function(){var e=this.props,t=e.match,a=e.location;console.log(a);var n=this.state,o=n.username,s=n.userId;return r.a.createElement("div",null,r.a.createElement(b,{username:o,onLogout:this.handleLogout,location:a}),r.a.createElement(p.a,{path:t.url,exact:!0,render:function(e){return r.a.createElement(W,Object.assign({userId:s},e))}}),r.a.createElement(p.a,{path:"".concat(t.url,"/:id"),render:function(e){return r.a.createElement(T,Object.assign({userId:s},e))}}))}}]),t}(n.Component),V=a(41),Z=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(i.a)(this,Object(u.a)(t).call(this,e))).state={username:"jack",password:"123456",redirectToRferrer:!1},a.handleChange=a.handleChange.bind(Object(f.a)(Object(f.a)(a))),a.handleSubmit=a.handleSubmit.bind(Object(f.a)(Object(f.a)(a))),a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"handleChange",value:function(e){"username"===e.target.name?this.setState({username:e.target.value}):"password"===e.target.name?this.setState({password:e.target.value}):console.log("do nothing")}},{key:"handleSubmit",value:function(e){var t=this;e.preventDefault();var a=this.state.username,n=this.state.password;if(0!==a.length&&0!==n.length){var r={username:a,password:n};I(L(),r).then(function(e){console.log(e.userId),e.error?alert(e.error.message||"login failed"):(sessionStorage.setItem("userId",e.userId),sessionStorage.setItem("username",a),t.setState({redirectToRferrer:!0}))})}else alert("\u7528\u6237\u540d\u6216\u8005\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a")}},{key:"render",value:function(){var e=(this.props.location.state||{from:{pathname:"/"}}).from,t=this.state.redirectToRferrer;return console.log(t),console.log(this.props.location.state),t?r.a.createElement(V.a,{to:e}):r.a.createElement("div",{className:"login"},r.a.createElement("form",{className:"login-form",onSubmit:this.handleSubmit},r.a.createElement("div",{className:"label-login"},r.a.createElement("span",null,"\u7528\u6237\u540d\uff1a"),r.a.createElement("input",{name:"username",type:"text",value:this.state.username,onChange:this.handleChange})),r.a.createElement("div",{className:"label-login"},r.a.createElement("span",null,"\u5bc6\u7801\uff1a"),r.a.createElement("input",{type:"password",name:"password",value:this.state.password,onChange:this.handleChange})),r.a.createElement("input",{type:"submit",value:"\u767b\u5f55",className:"submit-login"})))}}]),t}(n.Component),Y=function(e){function t(){return Object(c.a)(this,t),Object(i.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement(m.a,null,r.a.createElement(d.a,null,r.a.createElement(p.a,{exact:!0,path:"/",component:K}),r.a.createElement(p.a,{path:"/login",component:Z}),r.a.createElement(p.a,{path:"/posts",component:K})))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(Y,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[19,2,1]]]);
//# sourceMappingURL=main.16f76c73.chunk.js.map